<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Tr·ª£ L√Ω HLV Kim ƒê·ªìng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
      .font-mono { font-family: 'Roboto Mono', monospace; }
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
      
      /* Animation */
      @keyframes spin { to { transform: rotate(360deg); } }
      .loading-spinner { animation: spin 1s linear infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.38.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0"
  }
}
</script>
</head>
<body class="text-slate-900">

    <!-- 1. LOADING & ERROR STATE (Visible by default until React takes over) -->
    <div id="loading-state" class="fixed inset-0 flex items-center justify-center bg-slate-50 z-50 p-6 text-center">
        <div class="max-w-md w-full">
            <div class="mb-4 text-4xl animate-bounce">‚öúÔ∏è</div>
            <h2 class="text-xl font-bold text-slate-800 mb-2">ƒêang t·∫£i Tr·ª£ L√Ω HLV...</h2>
            <p id="loading-text" class="text-slate-500 mb-6 text-sm">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t ƒë·ªÉ t·∫£i th∆∞ vi·ªán.</p>
            
            <!-- Timeout Message Container -->
            <div id="timeout-msg" class="hidden mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800 text-left">
                <p class="font-bold flex items-center gap-2 mb-2">‚ö†Ô∏è T·∫£i qu√° l√¢u?</p>
                <ul class="list-disc ml-5 space-y-1">
                    <li>Ki·ªÉm tra k·∫øt n·ªëi Internet (·ª©ng d·ª•ng c·∫ßn t·∫£i th∆∞ vi·ªán t·ª´ CDN).</li>
                    <li>N·∫øu ƒëang m·ªü file tr·ª±c ti·∫øp (<code>file://</code>), h√£y th·ª≠ ƒë∆∞a l√™n Host ho·∫∑c d√πng <b>Live Server</b>.</li>
                </ul>
                <button onclick="window.location.reload()" class="mt-3 w-full py-2 bg-amber-200 hover:bg-amber-300 rounded font-bold text-amber-900 transition-colors">Th·ª≠ t·∫£i l·∫°i</button>
            </div>

            <div id="protocol-warning" class="hidden mt-4 text-left bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-800">
                <p class="font-bold flex items-center gap-2 mb-2">‚ö†Ô∏è C·∫£nh b√°o ch·∫°y file tr·ª±c ti·∫øp</p>
                <p>Tr√¨nh duy·ªát c√≥ th·ªÉ ch·∫∑n ·ª©ng d·ª•ng ch·∫°y tr√™n giao th·ª©c <code>file://</code>.</p>
            </div>
        </div>
    </div>

    <!-- 2. REACT ROOT -->
    <div id="root"></div>

    <script>
        // Check protocol immediately
        if (window.location.protocol === 'file:') {
            document.getElementById('protocol-warning').classList.remove('hidden');
        }

        // Timeout handler: If React doesn't load in 5 seconds, show help
        setTimeout(function() {
            var loader = document.getElementById('loading-state');
            if (loader && loader.style.display !== 'none') {
                document.getElementById('timeout-msg').classList.remove('hidden');
                document.getElementById('loading-text').textContent = "Vi·ªác t·∫£i th∆∞ vi·ªán ƒëang ch·∫≠m h∆°n d·ª± ki·∫øn...";
            }
        }, 5000);

        // Global Error Handler
        window.onerror = function(msg, url, line, col, error) {
            const loadingDiv = document.getElementById('loading-state');
            if (loadingDiv) {
                loadingDiv.innerHTML = `
                    <div class="p-6 bg-red-50 text-red-900 rounded-xl border border-red-200 max-w-lg mx-auto mt-10 shadow-xl">
                        <h3 class="font-bold text-lg mb-2 flex items-center gap-2">‚ùå L·ªói Kh·ªüi ƒê·ªông</h3>
                        <p class="mb-4 text-sm">${msg}</p>
                        <div class="text-xs font-mono bg-white p-3 rounded border border-red-100 overflow-auto max-h-32 mb-4">
                            ${error ? error.stack : 'No stack trace'}
                        </div>
                        <button onclick="window.location.reload()" class="w-full px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold text-sm transition-colors">T·∫£i l·∫°i trang</button>
                    </div>
                `;
            }
        };

        // Polyfill
        if (!window.process) window.process = { env: {} };
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.3.1';
        import ReactDOM from 'https://esm.sh/react-dom@18.3.1/client';
        import { GoogleGenAI } from 'https://esm.sh/@google/genai@0.0.12';
        import { Play, Square, RefreshCw, Wand2, Radio, Flag, GraduationCap, BookOpen, Settings, Save, X, Key, AlertTriangle, Menu } from 'https://esm.sh/lucide-react@0.363.0';

        // --- Remove Loading Screen when React Starts ---
        const loadingEl = document.getElementById('loading-state');
        if(loadingEl) loadingEl.style.display = 'none';

        // --- DATA & LOGIC ---
        const MORSE_CODE = { 'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.', '.': '.-.-.-', ',': '--..--', '?': '..--..', ' ': '/' };

        const SEMAPHORE_CSS_ANGLES = {
            'REST': { rightArm: 0, leftArm: 0 }, ' ': { rightArm: 0, leftArm: 0 },
            'A': { rightArm: 45, leftArm: 0 }, 'B': { rightArm: 90, leftArm: 0 }, 'C': { rightArm: 135, leftArm: 0 }, 'D': { rightArm: 180, leftArm: 0 },
            'E': { rightArm: 0, leftArm: 135 }, 'F': { rightArm: 0, leftArm: -90 }, 'G': { rightArm: 0, leftArm: -45 }, 'H': { rightArm: 90, leftArm: 45 },
            'I': { rightArm: 90, leftArm: 135 }, 'J': { rightArm: 180, leftArm: -90 }, 'K': { rightArm: 45, leftArm: 180 }, 'L': { rightArm: 45, leftArm: -135 },
            'M': { rightArm: 45, leftArm: -90 }, 'N': { rightArm: 45, leftArm: -45 }, 'O': { rightArm: 135, leftArm: -90 }, 'P': { rightArm: 180, leftArm: 45 },
            'Q': { rightArm: 180, leftArm: 90 }, 'R': { rightArm: 180, leftArm: 135 }, 'S': { rightArm: 180, leftArm: -45 }, 'T': { rightArm: 180, leftArm: -135 },
            'U': { rightArm: 135, leftArm: 180 }, 'V': { rightArm: -45, leftArm: 180 }, 'W': { rightArm: -90, leftArm: 135 }, 'X': { rightArm: -45, leftArm: 135 },
            'Y': { rightArm: 90, leftArm: 180 }, 'Z': { rightArm: -45, leftArm: -90 }, 'NUM': { rightArm: 180, leftArm: -135 }
        };

        const toTelex = (str) => {
            let text = str.replace(/ƒë/g, 'dd').replace(/ƒê/g, 'DD').normalize('NFD');
            const tones = { '\u0301': 'S', '\u0300': 'F', '\u0309': 'R', '\u0303': 'X', '\u0323': 'J' };
            return text.split(' ').map(word => {
                let toneChar = '', newWord = '';
                for (const char of word) tones[char] ? toneChar = tones[char] : newWord += char;
                let processed = newWord.replace(/a\u0302/gi, 'aa').replace(/e\u0302/gi, 'ee').replace(/o\u0302/gi, 'oo').replace(/a\u0306/gi, 'aw').replace(/o\u031B/gi, 'ow').replace(/u\u031B/gi, 'uw');
                return processed.replace(/[\u0300-\u036f]/g, '').toUpperCase() + toneChar;
            }).join(' ');
        };

        class MorseAudioEngine {
            constructor() { this.actx = null; this.gain = null; this.timeouts = []; this.isPlaying = false; }
            init() { 
                if (!this.actx) { 
                    this.actx = new (window.AudioContext || window.webkitAudioContext)(); 
                    this.gain = this.actx.createGain(); 
                    this.gain.connect(this.actx.destination); 
                    this.gain.gain.value = 0; 
                } 
            }
            playTone(dur) {
                this.init(); if(!this.actx) return;
                const osc = this.actx.createOscillator(); osc.type = 'sine'; osc.frequency.setValueAtTime(750, this.actx.currentTime);
                osc.connect(this.gain);
                const now = this.actx.currentTime;
                osc.start(now);
                this.gain.gain.cancelScheduledValues(now);
                this.gain.gain.setValueAtTime(0, now);
                this.gain.gain.linearRampToValueAtTime(1, now + 0.005);
                this.gain.gain.setValueAtTime(1, now + dur - 0.005);
                this.gain.gain.linearRampToValueAtTime(0, now + dur);
                osc.stop(now + dur + 0.05);
            }
            stop() { this.isPlaying = false; this.timeouts.forEach(clearTimeout); this.timeouts = []; if(this.gain) this.gain.gain.cancelScheduledValues(0); }
            play(msg, wpm, onChar, onEnd) {
                this.stop(); this.isPlaying = true;
                const unit = 1200 / wpm / 1000;
                let time = 0;
                const add = (fn, delay) => this.timeouts.push(setTimeout(fn, delay * 1000));
                
                for (let i = 0; i < msg.length; i++) {
                    if (!this.isPlaying) break;
                    const char = msg[i], code = MORSE_CODE[char];
                    if (char === ' ') { time += unit * 7; continue; }
                    if (code) {
                        add(() => onChar(char), time);
                        for (let s of code) {
                            const dur = s === '.' ? unit : unit * 3;
                            add(() => this.playTone(dur), time);
                            time += dur + unit;
                        }
                        time += unit * 2; // (3 units total gap between letters)
                    }
                }
                add(() => { onEnd(); this.isPlaying = false; }, time);
            }
        }
        const audio = new MorseAudioEngine();

        const generateAI = async (mode, count, key) => {
            if (!key) throw new Error("Ch∆∞a nh·∫≠p API Key");
            const ai = new GoogleGenAI({ apiKey: key });
            const res = await ai.models.generateContent({
                model: 'gemini-1.5-flash',
                contents: `T·∫°o 1 c√¢u ti·∫øng Vi·ªát √Ω nghƒ©a v·ªÅ k·ªπ nƒÉng ƒê·ªôi/thi√™n nhi√™n, kho·∫£ng ${count} t·ª´.`,
                config: { systemInstruction: `B·∫°n l√† HLV Kim ƒê·ªìng. Tr·∫£ v·ªÅ text thu·∫ßn, kh√¥ng l·ªùi d·∫´n.`, temperature: 1 }
            });
            return (res.text || "LOI MANG").replace(/["']/g, '').trim();
        };

        // --- COMPONENTS ---

        const Header = ({ onOpenSettings }) => (
            <header className="bg-slate-900 text-white shadow-md sticky top-0 z-40">
                <div className="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <div className="bg-slate-800 p-2 rounded-lg border border-slate-700">
                            <GraduationCap size={24} className="text-sky-400" />
                        </div>
                        <div>
                            <h1 className="font-bold text-lg leading-tight">HLV Kim ƒê·ªìng</h1>
                            <div className="text-xs font-medium text-slate-400">Tr·ª£ l√Ω r√®n luy·ªán ƒê·ªôi vi√™n</div>
                        </div>
                    </div>
                    <button onClick={onOpenSettings} className="p-2 hover:bg-slate-800 rounded-full transition-colors text-slate-300 hover:text-white">
                        <Settings size={20} />
                    </button>
                </div>
            </header>
        );

        const SettingsModal = ({ isOpen, onClose, apiKey, setApiKey }) => {
            const [val, setVal] = useState(apiKey);
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm p-5 animate-[fadeIn_0.2s]">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-lg flex items-center gap-2"><Settings size={18}/> C√†i ƒë·∫∑t</h3>
                            <button onClick={onClose}><X size={20} className="text-slate-400 hover:text-slate-600"/></button>
                        </div>
                        <div className="mb-4">
                            <label className="block text-sm font-medium text-slate-700 mb-1">Google API Key</label>
                            <input type="password" value={val} onChange={e=>setVal(e.target.value)} className="w-full p-3 border rounded-lg text-sm font-mono focus:ring-2 focus:ring-sky-500 outline-none" placeholder="AIza..." />
                            <p className="text-xs text-slate-500 mt-2">D√πng ƒë·ªÉ t·∫°o ƒë·ªÅ b√†i t·ª± ƒë·ªông.</p>
                        </div>
                        <button onClick={()=>{setApiKey(val); onClose();}} className="w-full py-2.5 bg-slate-900 text-white rounded-lg font-bold hover:bg-slate-800 flex justify-center gap-2">
                            <Save size={18}/> L∆∞u l·∫°i
                        </button>
                    </div>
                </div>
            );
        };

        const SemaphoreFigure = ({ char }) => {
            const a = SEMAPHORE_CSS_ANGLES[char] || { rightArm: 0, leftArm: 0 };
            return (
                <div className="w-64 h-64 bg-white rounded-xl border border-slate-200 shadow-sm mx-auto relative">
                    <svg viewBox="0 0 400 400" className="w-full h-full">
                        <ellipse cx="200" cy="350" rx="100" ry="15" fill="#e2e8f0" />
                        <rect x="180" y="150" width="40" height="160" rx="10" fill="#334155" />
                        <circle cx="200" cy="110" r="30" fill="#f8d7da" stroke="#334155" strokeWidth="3" />
                        <g transform={`rotate(${90 + a.rightArm}, 180, 160)`}>
                            <rect x="180" y="160" width="100" height="15" rx="7" fill="#334155" />
                            <line x1="270" y1="167" x2="330" y2="167" stroke="#8B4513" strokeWidth="4" />
                            <path d="M 280 137 L 340 137 L 280 197 Z" fill="#FACC15" transform="translate(0,0)" />
                            <path d="M 340 137 L 340 197 L 280 197 Z" fill="#EF4444" transform="translate(0,0)" />
                        </g>
                        <g transform={`rotate(${90 + a.leftArm}, 220, 160)`}>
                            <rect x="220" y="160" width="100" height="15" rx="7" fill="#334155" />
                            <line x1="310" y1="167" x2="370" y2="167" stroke="#8B4513" strokeWidth="4" />
                            <path d="M 320 137 L 380 137 L 320 197 Z" fill="#FACC15" />
                            <path d="M 380 137 L 380 197 L 320 197 Z" fill="#EF4444" />
                        </g>
                    </svg>
                    <div className="absolute bottom-2 right-2 font-mono font-bold text-slate-300 text-xl">{char}</div>
                </div>
            );
        };

        const Trainer = ({ mode, apiKey, openSettings }) => {
            const isMorse = mode === 'MORSE';
            const [text, setText] = useState(isMorse ? 'CH√ÄO' : 'T·ª∞ H√ÄO');
            const [speed, setSpeed] = useState(isMorse ? 12 : 2000);
            const [len, setLen] = useState(2);
            const [playing, setPlaying] = useState(false);
            const [curChar, setCurChar] = useState('');
            const [curIdx, setCurIdx] = useState(-1);
            const [ans, setAns] = useState('');
            const [res, setRes] = useState(null);
            const [loading, setLoading] = useState(false);
            const timer = useRef(null);

            const telex = toTelex(text);

            useEffect(() => {
                return () => { audio.stop(); clearInterval(timer.current); };
            }, [mode]);

            const play = () => {
                if (playing) {
                    isMorse ? audio.stop() : clearInterval(timer.current);
                    setPlaying(false); setCurChar(''); setCurIdx(-1);
                } else {
                    setPlaying(true); setRes(null); setAns('');
                    if (isMorse) {
                        audio.play(telex, speed, setCurChar, () => { setPlaying(false); setCurChar(''); });
                    } else {
                        setCurIdx(0);
                        timer.current = setInterval(() => {
                            setCurIdx(p => {
                                if (p >= telex.length - 1) { setPlaying(false); clearInterval(timer.current); return -1; }
                                return p + 1;
                            });
                        }, speed);
                    }
                }
            };

            const gen = async () => {
                if (!apiKey) return openSettings();
                setLoading(true);
                try {
                    const t = await generateAI(mode, len, apiKey);
                    setText(t); setAns(''); setRes(null); setCurIdx(-1);
                } catch(e) { alert(e.message); }
                setLoading(false);
            };

            const check = () => {
                const u = ans.trim().toUpperCase();
                setRes(u === text.trim().toUpperCase() || u === telex);
            };

            return (
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className={`p-4 text-white flex justify-between items-center ${isMorse ? 'bg-sky-600' : 'bg-red-600'}`}>
                        <h2 className="font-bold text-lg flex gap-2 items-center">
                            {isMorse ? <Radio size={20}/> : <Flag size={20}/>} 
                            Luy·ªán {isMorse ? 'Morse' : 'Semaphore'}
                        </h2>
                        <span className="text-xs bg-white/20 px-2 py-1 rounded">Chu·∫©n Telex</span>
                    </div>

                    <div className="p-4 space-y-6">
                        {/* Settings */}
                        <div className="grid grid-cols-2 gap-4 bg-slate-50 p-4 rounded-lg">
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">T·ªëc ƒë·ªô ({isMorse ? 'WPM' : 'ms'})</label>
                                <input type="range" className={`w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-200 ${isMorse?'accent-sky-600':'accent-red-600'}`}
                                    min={isMorse?5:500} max={isMorse?30:4000} step={isMorse?1:100} 
                                    value={speed} onChange={e=>setSpeed(+e.target.value)} />
                                <div className="text-right font-bold text-sm">{isMorse ? speed : (speed/1000)+'s'}</div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 block mb-1">ƒê·ªô d√†i ({len} t·ª´)</label>
                                <input type="range" className={`w-full h-2 rounded-lg appearance-none cursor-pointer bg-slate-200 ${isMorse?'accent-sky-600':'accent-red-600'}`}
                                    min="1" max="15" value={len} onChange={e=>setLen(+e.target.value)} />
                            </div>
                        </div>

                        {/* Display */}
                        <div className="flex justify-center items-center min-h-[160px]">
                            {isMorse ? (
                                <div className={`text-6xl font-mono font-bold transition-all ${playing && curChar ? 'text-sky-600 scale-110' : 'text-slate-200'}`}>
                                    {playing ? (curChar ? 'üîä' : '...') : <span className="text-sm text-slate-400 font-sans">S·∫µn s√†ng</span>}
                                </div>
                            ) : (
                                <SemaphoreFigure char={curIdx >= 0 ? telex[curIdx] : 'REST'} />
                            )}
                        </div>

                        {/* Actions */}
                        <div className="flex gap-2">
                            <button onClick={play} className={`flex-1 py-3 rounded-lg font-bold text-white shadow-sm flex items-center justify-center gap-2 ${playing ? 'bg-slate-700' : (isMorse?'bg-sky-600 hover:bg-sky-700':'bg-red-600 hover:bg-red-700')}`}>
                                {playing ? <Square size={18}/> : <Play size={18}/>} {playing ? 'D·ª´ng' : 'B·∫Øt ƒë·∫ßu'}
                            </button>
                            <button onClick={gen} disabled={loading||playing} className={`px-4 rounded-lg font-bold flex items-center gap-2 ${!apiKey ? 'bg-slate-100 text-slate-400' : 'bg-amber-100 text-amber-700'}`}>
                                {loading ? <RefreshCw className="animate-spin" size={18}/> : <Wand2 size={18}/>} AI
                            </button>
                        </div>

                        {/* Answer */}
                        <div className="space-y-2">
                            <input value={ans} onChange={e=>setAns(e.target.value.toUpperCase())} className="w-full p-3 border-2 border-slate-100 rounded-lg font-mono uppercase focus:border-slate-400 outline-none transition-colors" placeholder="Nh·∫≠p ƒë√°p √°n..." />
                            <button onClick={check} className="w-full py-2 bg-slate-800 text-white rounded-lg font-bold">Ki·ªÉm tra</button>
                        </div>

                        {/* Result */}
                        {res !== null && (
                            <div className={`p-3 rounded-lg text-center font-bold ${res ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                                {res ? 'CH√çNH X√ÅC!' : `SAI R·ªíI! ƒê√ÅP √ÅN: ${text} (${telex})`}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const Reference = () => {
            const [tab, setTab] = useState('MORSE');
            const url = id => `https://drive.google.com/file/d/${id}/preview`;
            return (
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="flex border-b">
                        {['MORSE', 'SEMAPHORE'].map(t => (
                            <button key={t} onClick={()=>setTab(t)} className={`flex-1 py-3 font-bold text-sm ${tab===t ? 'text-sky-600 border-b-2 border-sky-600 bg-sky-50' : 'text-slate-500 hover:bg-slate-50'}`}>{t}</button>
                        ))}
                    </div>
                    <div className="aspect-video bg-slate-100 relative">
                         <iframe src={url(tab==='MORSE'?"1Rcou2G1_pK_cKLCwhPcG3mJYIR25OWiD":"1jtNFRsQqA36HTBMQ3LPZ6BxF4gOpZXhd")} className="absolute inset-0 w-full h-full" allow="autoplay"></iframe>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('MORSE');
            const [key, setKey] = useState(localStorage.getItem('API_KEY')||'');
            const [setOpen, setSetOpen] = useState(false);

            const saveKey = k => { setKey(k); localStorage.setItem('API_KEY', k); };

            return (
                <div className="min-h-screen flex flex-col">
                    <Header onOpenSettings={()=>setSetOpen(true)} />
                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-20 mt-6">
                        {/* Compact Tab Switcher */}
                        <div className="flex bg-white p-1 rounded-xl shadow-sm border border-slate-200 mb-4">
                            {[
                                {id:'MORSE', icon: Radio, label: 'Morse'},
                                {id:'SEMAPHORE', icon: Flag, label: 'Sema'},
                                {id:'REF', icon: BookOpen, label: 'Tra c·ª©u'}
                            ].map(i => (
                                <button key={i.id} onClick={()=>setView(i.id)} 
                                    className={`flex-1 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-all ${view===i.id ? 'bg-slate-800 text-white shadow' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    <i.icon size={14}/> {i.label}
                                </button>
                            ))}
                        </div>

                        {view === 'REF' ? <Reference /> : <Trainer mode={view} apiKey={key} openSettings={()=>setSetOpen(true)} />}
                    </main>

                    <SettingsModal isOpen={setOpen} onClose={()=>setSetOpen(false)} apiKey={key} setApiKey={saveKey} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>